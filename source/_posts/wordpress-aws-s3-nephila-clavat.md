---
title: "WordPressに投稿したメディアをAWS S3に自動的にアップロードする「Nephila clavata (絡新婦)」をインストールしてみた"
date: 2013-04-20T13:15:18.000Z
updated: 2016-04-03T13:18:21.000Z
tags: 
  - WordPress
  - プラグイン
---

以前にサーバをAWSのEC2に移管した旨を記載させて頂きましたが、静的なデータはEC2ではなくS3に置いておいたほうが効率的のような気がしていました。

ただ、毎回S3にファイルをアップして、ブログでリンクを貼る作業をしようとするとどうしても面倒だったところ、WordPressで投稿したメディアを自動的にS3にアップしてくれるプラグイン「Nephila clavata (絡新婦)」があったので試してみました。


## 仕組みについて

[![我が家のお猫様です](/content/images/2016/04/photo.jpg)](/content/images/2016/04/photo.jpg)

WordPressでメディアを追加すると、「/wp-contet/uploads/***」に保存されますが、その「uploads」以下のデータをS3に転送します。

管理画面上の操作はWordPress設置側のメディアを扱い、表示時に自動的にメディアへのリンクURLをS3側に書き換えて表示されるようです。

なので右図の画像は「blog.sus-happy.net」にも存在していますが、表示する際に自動的に「s3.sus-happy.net」に書き換えられて表示されるようになります。


## 実装方法

### S3バケットの用意

AWSのアカウントを持っていないのであれば、[AWSのサイト](http://aws.amazon.com/jp/)からアカウントを作成します。

バケットの用意の仕方については、[こちらのサイトで詳しくご紹介されております](http://gatespace.jp/2013/03/05/aws-s3-static-site/)ので、ご参考にしていただければと思います。

### プラグインのインストール

Nephila clavata (絡新婦)プラグインは[公式ディレクトリに公開されています](http://wordpress.org/extend/plugins/nephila-clavata/)ので、そちらからダウンロードしてアップ、または管理画面からインストールして有効化します。

### 設定内容

有効化すると「設定」の中に「Nephila clavata (絡新婦)」というメニューが追加されますので、下記を参考に入力します。

<dl><dt>AWS アクセスキー ID</dt><dd>アクセスキー ID</dd><dt>AWS シークレットアクセスキー</dt><dd>シークレットアクセスキー</dd><dt>AWS リージョン</dt><dd>S3を作成したリージョンを選択</dd></dl>上記内容を入力、一度保存をして、登録内容に間違いが無ければ、下記入力欄が表れます。

<dl><dt>S3 バケット</dt><dd>「S3バケットの用意」で登録したバケット名を選択</dd><dt>S3 URL</dt><dd>バケットのプロパティに表示される「Endpoint」のURLを入力  
 もしくは、バケットを作成する時に独自ドメインでホスティング出来るようにした場合はそのURLを入力</dd></dl>すると、今までのメディアも自動的にAWS S3にアップロードしてくれます。


## 注意点

- WordPressを設置しているサーバにもメディアは残るので、容量削減の名目で利用することは出来ません。  
 （プラグインが無効化された時でもメディアにリンクが繋がるようにするため）
- AWS SDK for PHP 2を利用しているためPHP 5.3以降のバージョンが必要


## 雑感

PHP等のプログラムをEC2で、静的データをS3に置いたほうが負荷分散も出来ていいよなぁ、なんて思ってはいたのですが、実際にやろうと思うと腰が重かったのが、こういった便利なプラグインなどで簡単に出来ると非常に嬉しいですね。


## 参考

- [S3 にメディアを自動アップロードするプラグイン「絡新婦」 | dogmap.jp](http://dogmap.jp/2013/03/01/nephila-clavata/)
- [AWS S3 のバケットに独自ドメインを割り当てて、静的ファイルをホスティング | Gatespace's Blog](http://gatespace.jp/2013/03/05/aws-s3-static-site/)