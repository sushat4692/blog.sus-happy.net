---
title: "GoogleAnalyticsの一つのプロファイルでサブドメインを含めた解析をしてみた"
date: 2011-01-10T22:25:25.000Z
updated: 2016-04-03T15:26:52.000Z
tags: 
  - Google
  - Google Analytics
  - SEO
---

サブドメインは別サイト、と考えるとそこまでは需要があるとは考えにくいですが、自分のサイトをちょっとまとめて解析したかったので、一つのプロファイルでサブドメインを含めた解析をする方法を調べてみました。

参考：[[Google Analytics]すべてのサブドメインを1つのプロファイルでトラッキングする方法 :: 日々是作譜](http://pgjapan.net/2009/05/google-analytics-track-all-of-subdomains-in-one-profile.html)


## トラッキングコードの準備

トラッキングコードをコピーする画面で「何をトラッキングしますか？」の項目を「複数のサブドメインがある １ つのドメイン」にセットした時のコードを利用します。

既に貼っているトップレベルドメインのトラッキングコードを貼っている方は、「`_gaq.push([‘_setAccount’, ‘***’]);`」の後に、

```javascript
_gaq.push(['_setDomainName', '.example.com']);
```

を追加するだけでも構いません。（example.comを各自の独自ドメインに変更してください）

これで、サブドメインを含めたドメインを全て取得することが可能ですが、このままではホスト名以降しか保存されないので、「index.html」でもどのドメインの「index.html」か判断することが出来ません。


## カスタムフィルタの利用

そこで、カスタムフィルタを利用します。カスタムフィルタは、Analytics設定ページ（プロファイルが並んでいるページ）の右下にある「フィルタマネージャ」から作成します。

「フィルタ名」は任意の名前を入力、フィルタの種類は「カスタムフィルタ」、「詳細」を選択します。

「詳細」を選んで現れた入力項目に、

<dl>
<dt>「フィールド A -> 引用 A」</dt>
<dd>「ホスト名」＞「(.*)」</dd>
<dt>「フィールド B -> 引用 B」</dt>
<dd>「リクエストURI」＞「(.*)」</dd>
<dt>「出力先 -> コンストラクタ」</dt>
<dd>「リクエストURI」＞「$A1$B1」</dd>
</dl>
をそれぞれ入力します。

最後に、サブドメインまでの解析を行っているプロファイルを「選択したプロファイル」に追加すれば完了。

カスタムフィルタをかけた後では、「example.com/index.html」や、「hoge.example.com/index.html」の様に取得するようになります。